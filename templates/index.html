<!DOCTYPE html>

<html lang="en">

<head>

Â  <meta charset="UTF-8" />

Â  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

Â  <title>SET Game â€” Multiplayer</title>

Â  <script src="https://cdn.tailwindcss.com"></script>

Â  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>

Â  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

Â  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

Â  <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>

Â  <style>

Â  Â  .card-container { border: 2px solid transparent; border-radius: 12px; background: white; display: flex; flex-direction: column; justify-content: center; align-items: center; box-shadow: 0 3px 6px rgba(0,0,0,0.2); transition: transform 0.2s, border-color 0.2s; aspect-ratio: 2.5 / 3.5; padding: 4px; width: 78px; height: 108px; }

Â  Â  .card-container:hover { transform: scale(1.04); }

Â  Â  .card-container.selected { border-color: gold; box-shadow: 0 0 10px gold; }

Â  Â  .card-container.hint { border-color: #22c55e; box-shadow: 0 0 10px #22c55e; }

Â  Â  .card-svg-wrapper { width: 56%; height: auto; }

Â  Â  .card-svg { width: 100%; height: 100%; margin: 0 auto; overflow: visible; }

Â  </style>

</head>

<body class="bg-gradient-to-br from-slate-900 via-indigo-900 to-purple-900 text-white min-h-screen">

Â  <div id="root"></div>



Â  <script type="text/babel">

Â  const { useState, useEffect, useRef } = React;

Â  const socket = io("http://localhost:4000");



Â  // --- Card logic (simpler, high-contrast symbols) ---

Â  const colors = ["red", "green", "blue"];

Â  const shapes = ["circle", "diamond", "pill"]; // easy to tell apart

Â  const numbers = [1, 2, 3];

Â  const shadings = ["solid", "striped", "open"];



Â  const makeDeck = (full = true) => {

Â  Â  const deck = [];

Â  Â  colors.forEach(c => shapes.forEach(s => numbers.forEach(n =>

Â  Â  Â  (full ? shadings : ["solid"]).forEach(sh => deck.push({ color: c, shape: s, number: n, shading: sh })))));

Â  Â  // shuffle

Â  Â  for (let i = deck.length - 1; i > 0; i--) {

Â  Â  Â  const j = Math.floor(Math.random() * (i + 1));

Â  Â  Â  [deck[i], deck[j]] = [deck[j], deck[i]];

Â  Â  }

Â  Â  return deck;

Â  };



Â  const isSet = (a, b, c) => {

Â  Â  const check = key => {

Â  Â  Â  const vals = [a[key], b[key], c[key]];

Â  Â  Â  return new Set(vals).size !== 2; // not exactly-two-of-a-kind

Â  Â  };

Â  Â  return check("color") && check("shape") && check("number") && check("shading");

Â  };



Â  const whichFail = (a, b, c) => {

Â  Â  const fails = [];

Â  Â  ["color","shape","number","shading"].forEach(key => {

Â  Â  Â  const size = new Set([a[key], b[key], c[key]]).size;

Â  Â  Â  if (size === 2) fails.push(key);

Â  Â  });

Â  Â  return fails;

Â  };



Â  const findSet = (cards) => {

Â  Â  for (let i = 0; i < cards.length - 2; i++)

Â  Â  Â  for (let j = i + 1; j < cards.length - 1; j++)

Â  Â  Â  Â  for (let k = j + 1; k < cards.length; k++)

Â  Â  Â  Â  Â  if (isSet(cards[i], cards[j], cards[k])) return [i, j, k];

Â  Â  return null;

Â  };



Â  const Card = ({ card, selected, hinted, onClick }) => {

Â  Â  if (!card) return null;

Â  Â  const stroke = card.color;

Â  Â  const fill = card.shading === "solid" ? card.color : card.shading === "striped" ? `url(#pat-${card.color})` : "none";



Â  Â  const offsets = { 1: [0], 2: [-14, 14], 3: [-22, 0, 22] };



Â  Â  return (

Â  Â  Â  <button onClick={onClick} className={`bg-white text-black rounded-lg shadow card-container ${selected ? 'selected' : ''} ${hinted ? 'hint' : ''}`}>

Â  Â  Â  Â  <div className="card-svg-wrapper">

Â  Â  Â  Â  Â  <svg viewBox="0 0 80 80" className="card-svg">

Â  Â  Â  Â  Â  Â  <defs>

Â  Â  Â  Â  Â  Â  Â  {colors.map(c => (

Â  Â  Â  Â  Â  Â  Â  Â  <pattern key={c} id={`pat-${c}`} patternUnits="userSpaceOnUse" width="8" height="8">

Â  Â  Â  Â  Â  Â  Â  Â  Â  <path d="M0 8 L8 0" stroke={c} strokeWidth="1" />

Â  Â  Â  Â  Â  Â  Â  Â  </pattern>

Â  Â  Â  Â  Â  Â  Â  ))}

Â  Â  Â  Â  Â  Â  </defs>



Â  Â  Â  Â  Â  Â  {offsets[card.number].map((dy, i) => (

Â  Â  Â  Â  Â  Â  Â  <g key={i} transform={`translate(0, ${dy})`}>

Â  Â  Â  Â  Â  Â  Â  Â  {card.shape === "circle" && (

Â  Â  Â  Â  Â  Â  Â  Â  Â  <circle cx="40" cy="40" r="14" fill={fill} stroke={stroke} strokeWidth="2" />

Â  Â  Â  Â  Â  Â  Â  Â  )}

Â  Â  Â  Â  Â  Â  Â  Â  {card.shape === "diamond" && (

Â  Â  Â  Â  Â  Â  Â  Â  Â  <polygon points="40,18 62,40 40,62 18,40" fill={fill} stroke={stroke} strokeWidth="2" />

Â  Â  Â  Â  Â  Â  Â  Â  )}

Â  Â  Â  Â  Â  Â  Â  Â  {card.shape === "pill" && (

Â  Â  Â  Â  Â  Â  Â  Â  Â  <rect x="22" y="26" width="36" height="28" rx="12" ry="12" fill={fill} stroke={stroke} strokeWidth="2" />

Â  Â  Â  Â  Â  Â  Â  Â  )}

Â  Â  Â  Â  Â  Â  Â  </g>

Â  Â  Â  Â  Â  Â  ))}

Â  Â  Â  Â  Â  </svg>

Â  Â  Â  Â  </div>

Â  Â  Â  </button>

Â  Â  );

Â  };



Â  // --- Main App ---

Â  const App = () => {

Â  Â  const [deck, setDeck] = useState([]);

Â  Â  const [table, setTable] = useState([]);

Â  Â  const [selected, setSelected] = useState([]);

Â  Â  const [hinted, setHinted] = useState([]);

Â  Â  const [message, setMessage] = useState('');

Â  Â  const [timer, setTimer] = useState(0);

Â  Â  const [playerName, setPlayerName] = useState('');

Â  Â  const [gameId, setGameId] = useState(null);

Â  Â  const [isHost, setIsHost] = useState(false);

Â  Â  const [gameStarted, setGameStarted] = useState(false);

Â  Â  const [players, setPlayers] = useState([]);

Â  Â  const [showTutorial, setShowTutorial] = useState(true);

Â  Â  const timerRef = useRef(null);



Â  Â  // helper to normalize players payloads from server

Â  Â  const normalizePlayers = (arr) => {

Â  Â  Â  if (!Array.isArray(arr)) return [];

Â  Â  Â  return arr.map(p => {

Â  Â  Â  Â  if (typeof p === 'string') return { name: p, score: 0 };

Â  Â  Â  Â  if (p && p.username && !p.name) return { name: p.username, score: p.score ?? 0 };

Â  Â  Â  Â  return { name: p.name ?? 'Player', score: p.score ?? 0 };

Â  Â  Â  });

Â  Â  };



Â  Â  useEffect(() => {

Â  Â  Â  if (gameStarted) {

Â  Â  Â  Â  if (!timerRef.current) {

Â  Â  Â  Â  Â  timerRef.current = setInterval(() => setTimer(t => t + 1), 1000);

Â  Â  Â  Â  }

Â  Â  Â  } else {

Â  Â  Â  Â  clearInterval(timerRef.current);

Â  Â  Â  Â  timerRef.current = null;

Â  Â  Â  }

Â  Â  Â  return () => {};

Â  Â  }, [gameStarted]);



Â  Â  useEffect(() => {

Â  Â  Â  socket.on("room_created", (data) => {

Â  Â  Â  Â  setGameId(data.room_id);

Â  Â  Â  Â  setIsHost(true);

Â  Â  Â  Â  setPlayers(prev => prev.length ? prev : [{ name: playerName || 'You', score: 0 }]);

Â  Â  Â  Â  setMessage(`Room created: ${data.room_id}`);

Â  Â  Â  });



Â  Â  Â  socket.on("player_joined", (data) => {

Â  Â  Â  Â  const list = normalizePlayers(data.players);

Â  Â  Â  Â  setPlayers(list.length ? list : [{ name: playerName || 'You', score: 0 }]);

Â  Â  Â  Â  setMessage(`Player joined: ${data.username || ''}`);

Â  Â  Â  Â  if (isHost) {

Â  Â  Â  Â  Â  socket.emit("sync_state", { room: gameId, deck, table, gameStarted });

Â  Â  Â  Â  }

Â  Â  Â  });



Â  Â  Â  socket.on("game_state", (state) => {

Â  Â  Â  Â  setDeck(state.deck || []);

Â  Â  Â  Â  setTable(state.table || []);

Â  Â  Â  Â  setGameStarted(!!state.gameStarted);

Â  Â  Â  });



Â  Â  Â  socket.on("scoreboard", (updatedPlayers) => {

Â  Â  Â  Â  const list = normalizePlayers(updatedPlayers);

Â  if (list.length) {

Â  Â  // sort by score descending

Â  Â  list.sort((a, b) => (b.score ?? 0) - (a.score ?? 0));

Â  Â  setPlayers(list);

Â  }

Â  Â  Â  });



Â  Â  Â  return () => {

Â  Â  Â  Â  socket.off("room_created");

Â  Â  Â  Â  socket.off("player_joined");

Â  Â  Â  Â  socket.off("game_state");

Â  Â  Â  Â  socket.off("scoreboard");

Â  Â  Â  };

Â  Â  }, [playerName, isHost, deck, table, gameId, gameStarted]);



Â  Â  const broadcastState = (newDeck, newTable, started = true) => {

Â  Â  Â  setDeck(newDeck);

Â  Â  Â  setTable(newTable);

Â  Â  Â  setGameStarted(started);

Â  Â  Â  if (gameId) {

Â  Â  Â  Â  socket.emit("update_state", { room: gameId, deck: newDeck, table: newTable, gameStarted: started });

Â  Â  Â  }

Â  Â  };



Â  Â  const ensureSelfInPlayers = () => {

Â  Â  Â  setPlayers(prev => {

Â  Â  if (prev.length === 0) return [{ name: playerName, score: 0 }];

Â  Â  const hasSelf = prev.some(p => p.name === playerName);

Â  Â  return hasSelf ? prev : [...prev, { name: playerName, score: 0 }];

Â  Â  Â  Â });

Â  Â  Â  };



Â  Â  const startGame = (full = true) => {

Â  Â  Â  const d = makeDeck(full);

Â  Â  Â  const initDeck = d.slice(12);

Â  Â  Â  const initTable = d.slice(0, 12);

Â  Â  Â  broadcastState(initDeck, initTable, true);

Â  Â  Â  setSelected([]); setHinted([]); setMessage('');

Â  Â  Â  setTimer(0);

Â  Â  Â  setShowTutorial(false);

Â  Â  Â  ensureSelfInPlayers(); // always show a scoreboard entry locally

Â  Â  };



Â  Â  const clickCard = idx => {

Â  Â  Â  if (selected.includes(idx)) setSelected(selected.filter(i => i !== idx));

Â  Â  Â  else if (selected.length < 3) setSelected([...selected, idx]);

Â  Â  };



Â  Â  const submitSet = () => {

Â  Â  Â  if (selected.length !== 3) {

Â  Â  Â  Â  alert("âš ï¸ You must select exactly 3 cards before submitting!");

Â  Â  Â  Â  return;

Â  Â  Â  }

Â  Â  Â  const [a, b, c] = selected.map(i => table[i]);

Â  Â  Â  if (!a || !b || !c) return; // safety

Â  Â  Â  if (isSet(a, b, c)) {

Â  Â  Â  Â  const remaining = table.filter((_, i) => !selected.includes(i));

Â  Â  Â  Â  const newCards = deck.slice(0, 3);

Â  Â  Â  Â  const newTable = [...remaining, ...newCards];

Â  Â  Â  Â  const newDeck = deck.slice(3);

Â  Â  Â  Â  broadcastState(newDeck, newTable);



Â  Â  Â  Â  // update score locally (works for single or multiplayer)

Â  Â  Â  Â  setPlayers(prev => prev.map(p => p.name === (playerName || 'You') ? { ...p, score: (p.score || 0) + 1 } : p));

Â  Â  Â  Â  if (gameId) socket.emit("score_update", { room: gameId, username: playerName || 'You' });



Â  Â  Â  Â  setMessage("âœ… Set found!");

Â  Â  Â  Â  const noMoreCards = newDeck.length === 0;

Â  Â  Â  Â  const noMoreSets = findSet(newTable) === null;

Â  Â  Â  Â  if (noMoreCards && noMoreSets) {

Â  Â  Â  Â  Â  const winner = [...players].sort((x, y) => (y.score||0) - (x.score||0))[0] || { name: playerName || 'You', score: 0 };

Â  Â  Â  Â  Â  setTimeout(() => alert(`ðŸŽ‰ Game Over! Winner is ${winner.name} with ${winner.score} points!`), 50);

Â  Â  Â  Â  }

Â  Â  Â  } else {

Â  Â  Â  Â  const fails = whichFail(a, b, c);

Â  Â  Â  Â  alert(`âŒ Not a set! Conflicts in: ${fails.join(', ') || 'unknown'}`);

Â  Â  Â  }

Â  Â  Â  setSelected([]); setHinted([]);

Â  Â  };



Â  Â  const hint = () => {

Â  Â  Â  const foundSet = findSet(table);

Â  Â  Â  if (foundSet) setHinted(foundSet);

Â  Â  Â  else setMessage("No set found.");

Â  Â  };



Â  Â  const dealThree = () => {

Â  Â  Â  if (!deck.length) return setMessage("No more cards!");

Â  Â  Â  const newTable = [...table, ...deck.slice(0, 3)];

Â  Â  Â  const newDeck = deck.slice(3);

Â  Â  Â  broadcastState(newDeck, newTable);

Â  Â  };



Â  Â  const createMultiplayer = () => {

Â  Â  Â  if (!playerName) return setMessage("Enter your name first!");

Â  Â  Â  socket.emit("create_room", { username: playerName });

Â  Â  Â  ensureSelfInPlayers();

Â  Â  };



Â  Â  const joinMultiplayer = (joinCode) => {

Â  Â  Â  if (!playerName || !joinCode) return setMessage("Enter name + code!");

Â  Â  Â  socket.emit("join_room", { username: playerName, room: joinCode });

Â  Â  Â  setGameId(joinCode);

Â  Â  Â  ensureSelfInPlayers();

Â  Â  };



Â  Â  return (

Â  Â  Â  <div className="p-4 flex flex-col items-center">

Â  Â  Â  Â  <h1 className="text-2xl font-bold mb-2">SET Game</h1>



Â  Â  Â  Â  {showTutorial && !gameStarted && (

Â  Â  Â  Â  Â  <div className="bg-gray-800 p-4 rounded mb-4 max-w-md text-left">

Â  Â  Â  Â  Â  Â  <h2 className="font-bold text-lg mb-2">How to Play</h2>

Â  Â  Â  Â  Â  Â  <ul className="list-disc list-inside text-sm space-y-1">

Â  Â  Â  Â  Â  Â  Â  <li>Each card has a color, shape, number, and shading.</li>

Â  Â  Â  Â  Â  Â  Â  <li>A set is 3 cards where each feature is either all the same or all different.</li>

Â  Â  Â  Â  Â  Â  Â  <li>Select 3 cards and click "Submit Set".</li>

Â  Â  Â  Â  Â  Â  Â  <li>You can request a hint or deal 3 more cards if needed.</li>

Â  Â  Â  Â  Â  Â  Â  <li>Game ends when no sets remain and the deck is empty.</li>

Â  Â  Â  Â  Â  Â  </ul>

Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  )}



Â  Â  Â  Â  <div className="text-center mb-4">

Â  Â  Â  Â  Â  Timer: {String(Math.floor(timer / 60)).padStart(2,'0')}:{String(timer % 60).padStart(2,'0')}

Â  Â  Â  Â  Â  <span className="ml-4">Cards: {table.length} / {table.length + deck.length}</span>

Â  Â  Â  Â  </div>



Â  Â  Â  Â  {!gameStarted && !gameId ? (

Â  Â  Â  Â  Â  <div className="flex flex-col items-center gap-4">

Â  Â  Â  Â  Â  Â  <input value={playerName} onChange={e => setPlayerName(e.target.value)} placeholder="Enter your name" className="text-black rounded px-2 py-1"/>

Â  Â  Â  Â  Â  Â  <button onClick={() => startGame(true)} className="bg-blue-500 px-3 py-1 rounded">Single Player (81 Cards)</button>

Â  Â  Â  Â  Â  Â  <button onClick={() => startGame(false)} className="bg-purple-500 px-3 py-1 rounded">Single Player (27 Cards)</button>

Â  Â  Â  Â  Â  Â  <button onClick={createMultiplayer} className="bg-green-500 px-3 py-1 rounded">Create Multiplayer</button>

Â  Â  Â  Â  Â  Â  <div className="flex items-center gap-2">

Â  Â  Â  Â  Â  Â  Â  <input id="joinCode" placeholder="Game Code" className="text-black rounded px-2 w-28"/>

Â  Â  Â  Â  Â  Â  Â  <button onClick={() => joinMultiplayer(document.getElementById('joinCode').value)} className="bg-green-700 px-3 py-1 rounded">Join Multiplayer</button>

Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  ) : (

Â  Â  Â  Â  Â  <>

Â  Â  Â  Â  Â  Â  {isHost && !gameStarted && (

Â  Â  Â  Â  Â  Â  Â  <div className="mt-4 p-4 bg-gray-800 rounded text-center">

Â  Â  Â  Â  Â  Â  Â  Â  <p className="mb-1">Game ID: <span className="font-mono">{gameId}</span></p>

Â  Â  Â  Â  Â  Â  Â  Â  <p>Select mode:</p>

Â  Â  Â  Â  Â  Â  Â  Â  <button onClick={() => startGame(false)} className="bg-purple-500 px-3 py-1 m-1 rounded">27 Cards</button>

Â  Â  Â  Â  Â  Â  Â  Â  <button onClick={() => startGame(true)} className="bg-purple-700 px-3 py-1 m-1 rounded">81 Cards</button>

Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  )}



Â  Â  Â  Â  Â  Â  <div className="bg-gray-800 p-3 rounded mb-3 w-80 text-center">

Â  Â  Â  Â  Â  Â  Â  <h2 className="font-bold mb-2 text-lg">Scoreboard</h2>

Â  Â  Â  Â  Â  Â  Â  {players.length === 0 ? (

Â  Â  Â  Â  Â  Â  Â  Â  <p className="text-sm text-gray-300">No players yet</p>

Â  Â  Â  Â  Â  Â  Â  ) : (

Â  Â  Â  Â  Â  Â  Â  Â  <ul className="space-y-1">

Â  Â  Â  Â  Â  Â  Â  Â  Â  {players.map((p, i) => (

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li key={i} className="flex justify-between px-2">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span className="font-medium text-left truncate max-w-[60%]">{p.name}</span>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span className="font-semibold">{p.score ?? 0}</span>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </li>

Â  Â  Â  Â  Â  Â  Â  Â  Â  ))}

Â  Â  Â  Â  Â  Â  Â  Â  </ul>

Â  Â  Â  Â  Â  Â  Â  )}

Â  Â  Â  Â  Â  Â  </div>



Â  Â  Â  Â  Â  Â  <div className="flex gap-2 my-3">

Â  Â  Â  Â  Â  Â  Â  <button onClick={dealThree} className="bg-yellow-500 px-3 py-1 rounded">Deal 3</button>

Â  Â  Â  Â  Â  Â  Â  <button onClick={submitSet} className="bg-green-500 px-3 py-1 rounded">Submit Set</button>

Â  Â  Â  Â  Â  Â  Â  <button onClick={hint} className="bg-yellow-400 px-3 py-1 rounded">Hint</button>

Â  Â  Â  Â  Â  Â  </div>



Â  Â  Â  Â  Â  Â  {message && <p className="mb-2">{message}</p>}

Â  Â  Â  Â  Â  Â  <div className="grid grid-cols-3 gap-3">

Â  Â  Â  Â  Â  Â  Â  {table.map((card, idx) => (

Â  Â  Â  Â  Â  Â  Â  Â  <Card key={idx} card={card} selected={selected.includes(idx)} hinted={hinted.includes(idx)} onClick={() => clickCard(idx)}/>

Â  Â  Â  Â  Â  Â  Â  ))}

Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  </>

Â  Â  Â  Â  )}

Â  Â  Â  </div>

Â  Â  );

Â  };



Â  ReactDOM.createRoot(document.getElementById("root")).render(<App />);

Â  </script>

</body>

</html>
